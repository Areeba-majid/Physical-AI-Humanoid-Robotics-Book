# Data Model: Physical AI & Humanoid Robotics Textbook with RAG Chatbot

## Overview
This document defines the data models for the Physical AI & Humanoid Robotics textbook with RAG chatbot system, based on the entities identified in the feature specification.

## TextbookChapter
Represents one of the 6 required chapters with title, content, and metadata

**Fields**:
- id: UUID (primary key)
- title: String (required, max 200 characters)
- content: Text (required, the full chapter content)
- chapter_number: Integer (required, 1-6)
- word_count: Integer (computed from content)
- created_at: DateTime (timestamp)
- updated_at: DateTime (timestamp)

**Relationships**:
- One-to-many with Sections (optional)
- One TextbookChapter can have many Sections

## Section
Represents a section within a chapter (optional, for better organization)

**Fields**:
- id: UUID (primary key)
- title: String (required, max 200 characters)
- content: Text (required, the section content)
- section_number: Integer (required, within chapter context)
- chapter_id: UUID (foreign key to TextbookChapter)
- created_at: DateTime (timestamp)
- updated_at: DateTime (timestamp)

## Question
Represents a user query with text content, submission time, and IP address

**Fields**:
- id: UUID (primary key)
- content: Text (required, the question text)
- ip_address: String (required, user's IP for rate limiting)
- submission_time: DateTime (timestamp)
- chapter_scope_only: Boolean (optional, if question is limited to specific chapter)
- chapter_id: UUID (optional, foreign key to TextbookChapter for scoped questions)

## Answer
Represents a response generated by the RAG system with content, source citations, and timestamp

**Fields**:
- id: UUID (primary key)
- content: Text (required, the answer content)
- question_id: UUID (foreign key to Question)
- citations: JSON (required, array of citation objects with chapter and section references)
- response_time: Float (required, time taken to generate answer in seconds)
- created_at: DateTime (timestamp)

## UserSession
Represents a user's interaction session with rate limiting information

**Fields**:
- id: UUID (primary key)
- ip_address: String (required, user's IP address)
- first_request_time: DateTime (timestamp for rate limiting window start)
- request_count: Integer (number of requests in current window)
- created_at: DateTime (timestamp)
- updated_at: DateTime (timestamp)

## TextbookContentMetadata
Additional metadata for RAG operations, stored in PostgreSQL alongside vector embeddings in Qdrant

**Fields**:
- id: UUID (primary key, matches Qdrant point ID for synchronization)
- chapter_id: UUID (foreign key to TextbookChapter)
- section_id: UUID (foreign key to Section, optional)
- content_snippet: Text (the actual text that was embedded)
- embedding_model: String (the model used for embedding)
- created_at: DateTime (timestamp)

## Validation Rules
- TextbookChapter: chapter_number must be between 1 and 6 (inclusive)
- Question: content must not be empty and not exceed 1000 characters
- Answer: must have at least one citation when content is provided
- UserSession: request_count must not exceed 10 within the rate limiting window
- Content fields must be properly sanitized to prevent injection attacks